###############################################################################
# Base Configuration; this provides sane defaults for commonly used parts.
# -----------------------------------------------------------------------------
#
# Buildout instructions in this file are usually only changed by experienced
# developers.
#
# Beyond here there be dragons!

[buildout]
eggs-directory = eggs
download-cache = downloads
extends-cache = extends-cache

# Don't download new things unless needed to satisfy dependencies.
# Override this on the command line with the "-n" flag.
newest = <%= @newest %>

# Pick final releases over newer development releases.
prefer-final = <%= @prefer_final %>

versions = versions

# Add additional egg download sources here. dist.plone.org contains archives
# of Plone packages.
find-links =
    <% @find_links.each do |link| -%>
    <%= link %>
    <% end -%>

# Unzip all eggs for easier debugging
unzip = <%= @unzip %>

# buildout.dumppickedversions notifies you of versions picked by buildout that
# were not specifically pinned.
# buildout.sanitycheck makes sure you're not running buildout as root.
extensions =
    <% @extensions.each do |extension| -%>
    <%= extension %>
    <% end -%>


############################################
# var Directory
# -------------
# Sets the target directory for the "var" components of the install such as
# database and log files.
#
var-dir=${buildout:directory}/var


############################################
# Backup Directory
# ----------------
# Sets the target directory for the bin/backup and bin/snapshotbackup
# commands. Default is inside this project's var directory, but ideally
# this should be on a separate volume or backup server.
backups-dir=<%= @backups_dir %>


###############################################################################
# Environment Variables
# -----------------------------------------------------------------------------
# Some of the behavior of your Zope/Plone instances are controlled with OS
# environment variables. You may set those here in a key / value format.
# Some common settings:
#    * TZ allows you to set a time zone for systems where it's not
#      automatically available.
#    * zope_i18n_compile_mo_files allows for automatic compilation of
#      missing translation files (may slow startup).
#    * zope_i18n_allowed_languages allows you to limit the available
#      translations.
#    * PYTHON_EGG_CACHE determines where zipped python packages are unpacked
#      for use.
#    * PYTHONHASHSEED determines initial seed for hashes. "random" causes a
#      pseudo-random value is used to seed the hashes of str, bytes and datetime
#      objects.
environment-vars =
    <% @environment_vars.each do |item| -%>
    <%= item %>
    <% end -%>


blob-storage = ${buildout:var-dir}/blobstorage


[precompiler]
# This recipe is used in production installs to compile .py and .po files so
# that the daemon doesn't try to do it.
# For options see http://pypi.python.org/pypi/plone.recipe.precompiler
recipe = plone.recipe.precompiler
eggs = ${buildout:eggs}
compile-mo-files = true
extra-paths = ${buildout:directory}/products


[repozo]
# This recipe builds the repozo script for non-zeo installations.
recipe = zc.recipe.egg
eggs = ZODB3
scripts = repozo

[backup]
# This recipe builds the backup, restore and snapshotbackup commands.
# For options see http://pypi.python.org/pypi/collective.recipe.backup
recipe = collective.recipe.backup
location = ${buildout:backups-dir}/backups
blobbackuplocation = ${buildout:backups-dir}/blobstoragebackups
snapshotlocation = ${buildout:backups-dir}/snapshotbackups
blobsnapshotlocation = ${buildout:backups-dir}/blobstoragesnapshots
datafs = ${buildout:var-dir}/filestorage/Data.fs
blob-storage = ${buildout:var-dir}/blobstorage

[zopepy]
# Installs a zopepy python interpreter that runs with your full Zope
# environment
recipe = zc.recipe.egg
eggs = ${buildout:eggs}
interpreter = zopepy
scripts = zopepy


[zeoserver_base]
# Use this section to install and configure a Zope
# Enterprise Objects server.
# For options see http://pypi.python.org/pypi/plone.recipe.zeoserver
#
# If we try to start as root, Zope will switch to the user below
# effective-user = ${buildout:effective-user}
# Set storage
var = ${buildout:var-dir}
blob-storage = ${buildout:var-dir}/blobstorage
# Put the log, pid and socket files in var/zeoserver
zeo-log     = ${buildout:var-dir}/zeoserver/zeoserver.log
pid-file    = ${buildout:var-dir}/zeoserver/zeoserver.pid
socket-name = ${buildout:var-dir}/zeoserver/zeo.zdsock
